@import se.lu.nateko.cp.meta.core.data.*
@import se.lu.nateko.cp.meta.core.data.EnvriConfig
@import se.lu.nateko.cp.meta.core.HandleProxiesConfig
@import se.lu.nateko.cp.meta.views.LandingPageExtras
@import se.lu.nateko.cp.viewscore.CpMenu
@import se.lu.nateko.cp.doi.meta.Title
@import landpagesnips._

@(coll: StaticCollection, extras: LandingPageExtras, handleProxies: HandleProxiesConfig)(implicit envri: Envri, conf: EnvriConfig)
@ServerSidePage(coll.title, coll.references.doi.map(_.titles.getOrElse(Seq())(0)).getOrElse(Title(coll.title, None, None)).title.toString, CpMenu.default, headerExtra = Some(headerExtra), subHeading = Some("Collection")){
	<div class="row py-2 gy-4">
		<div class="col-md-8">
			@if(coll.nextVersion) {
				<div class="alert alert-warning">
					A newer version is available:
					@nextVersionLink(coll.nextVersion)
				</div>
			} else {}
			<div class="row gy-2">
				@doiProperty(coll.doi, handleProxies.doi)
				@if(coll.references.doi){
					@for(doi <- coll.references.doi){
						@if(doi.descriptions.length > 0){
							@property("Description (DOI)", doi.descriptions.map(_.description).mkString("\n"))
						}
						@htmlProperty{Collection creator}{
							@agentLink(coll.creator)
						}
						@if(doi.creators.length > 0){
							@property("Data creators", doi.creators.map(_.name.toString).mkString(", "))
						}
						@if(doi.contributors.length > 0){
							@property("Contributors", doi.contributors.map(_.name.toString).mkString(", "))
						}
						@for(pubYear <- doi.publicationYear){
							@property("Publication Year", pubYear.toString)
						}
						@for(publisher <- doi.publisher){
							@property("Publisher", publisher)
						}
						@if(doi.subjects.length > 0){
							@property("Subjects", doi.subjects.map(_.subject).mkString(", "))
						}
					}
				} else {
					@for(description <- coll.description){
						@property("Description", description)
					}
					@htmlProperty{Collection creator}{
						@agentLink(coll.creator)
					}
				}
				@if(coll.previousVersion) {
					@htmlProperty{Previous version}{@previousVersionLink(coll.previousVersion)}
				} else {}
				@citations(coll.references)

				<h2 class="fs-3 mt-5">Content</h2>
				@property("Number of items", coll.members.size.toString)
				@for((item, i) <- coll.members.zipWithIndex){
					@htmlProperty{
						@if(i == 0) {Items} else {}
					}{
						@staticDataItemLink(item)
					}
				}

				<h2 class="fs-3 mt-5">Statistics</h2>
				@htmlProperty{Downloads}{
					@extras.downloadStats.getOrElse("Not available")
				}
			</div>
		</div>
		<div class="col-md-4">
			<div class="row">
				@card(12, "bg-light"){@Html("")}{
					<div class="row gy-2">
						@htmlProperty{Metadata}{
							@collMetaDownloadButton(coll, "JSON", "json") •
							@collMetaDownloadButton(coll, "RDF/XML", "xml") •
							@collMetaDownloadButton(coll, "RDF/Turtle", "ttl")
						}
					</div>
				}
			</div>
		</div>
	</div>
}

@accessUrl = @{staticCollAccessUrl(coll.res)}

@headerExtra = {
	<a class="btn btn-secondary" href="@accessUrl">Download</a>
}

@staticDataItemLink(item: StaticDataItem) = {
	@item match {
		case PlainStaticObject(res, _, name) => {
			<a target="_blank" href=@{res}>@{name}</a>
		}
		case coll: StaticCollection => {
			<a target="_blank" href=@{coll.res}>@{coll.title}</a>
		}
	}
}
