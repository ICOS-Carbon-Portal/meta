@import se.lu.nateko.cp.meta.core.data._
@import se.lu.nateko.cp.meta.core.data.EnvriConfig
@import se.lu.nateko.cp.meta.core.HandleProxiesConfig
@import se.lu.nateko.cp.meta.views.LandingPageExtras
@import se.lu.nateko.cp.viewscore.CpMenu
@import landpagesnips._

@(coll: StaticCollection, extras: LandingPageExtras, handleProxies: HandleProxiesConfig)(implicit envri: Envri.Value, conf: EnvriConfig)
@ServerSidePage(coll.title, coll.title, envri, CpMenu.default, headerExtra = Some(headerExtra), subHeading = Some("Collection")){
	<div class="row py-2 gy-4">
		<div class="col-md-8">
			@if(coll.nextVersion) {
				<div class="alert alert-warning">
					A newer version is available:
					@nextVersionLink(coll.nextVersion)
				</div>
			}
			<div class="row gy-2">
				@DoiPanelHtmlRow(coll.doi, handleProxies.doi)
				@for(description <- coll.description){
					@property("Description", description)
				}
				@htmlProperty{Creator}{
					@agentLink(coll.creator)
				}
				@if(coll.previousVersion) {
					@htmlProperty{Previous version}{@previousVersionLink(coll.previousVersion)}
				}
				@citations(coll.references)

				<h2 class="fs-3 mt-5">Content</h2>
				@property("Number of items", coll.members.size.toString)
				@for((item, i) <- coll.members.zipWithIndex){
					@htmlProperty{
						@if(i == 0) {Items}
					}{
						@staticDataItemLink(item)
					}
				}

				<h2 class="fs-3 mt-5">Statistics</h2>
				@htmlProperty{Downloads}{
					@extras.downloadStats.getOrElse("Not available")
				}
			</div>
		</div>
		<div class="col-md-4">
			<div class="row">
				@card(12, "bg-light"){@Html("")}{
					<div class="row gy-2">
						@htmlProperty{Metadata}{
							@collMetaDownloadButton(coll, "JSON", "json") •
							@collMetaDownloadButton(coll, "RDF/XML", "xml") •
							@collMetaDownloadButton(coll, "RDF/Turtle", "ttl")
						}
					</div>
				}
			</div>
		</div>
	</div>
}

@accessUrl = @{staticCollAccessUrl(coll.res)}

@headerExtra = {
	<a class="btn btn-secondary" href="@accessUrl">Download</a>
}

@staticDataItemLink(item: StaticDataItem) = {
	@item match {
		case PlainStaticObject(res, _, name) => {
			<a target="_blank" href=@{res}>@{name}</a>
		}
		case coll: StaticCollection => {
			<a target="_blank" href=@{coll.res}>@{coll.title}</a>
		}
	}
}
