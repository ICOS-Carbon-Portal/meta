<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>SPARQL Query</title>
	<link rel="stylesheet" href="https://static.icos-cp.eu/constant/bootstrap/3.3.4/css/bootstrap.min.css">

	<script type="text/javascript" src="https://static.icos-cp.eu/constant/jquery/1.11.2/jquery.min.js"></script>

	<script type="text/javascript">

		function syntaxHighlight(json) {
			if (typeof json != 'string') {
				json = JSON.stringify(json, undefined, 2);
			}
			json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
			return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
				var cls = 'number';
				if (/^"/.test(match)) {
					if (/:$/.test(match)) {
						cls = 'key';
					} else {
						cls = 'string';
					}
				} else if (/true|false/.test(match)) {
					cls = 'boolean';
				} else if (/null/.test(match)) {
					cls = 'null';
				}
				return '<span class="' + cls + '">' + match + '</span>';
			});
		}

		function getSparqlUrl(){
			if (location.hostname == "static.icos-cp.eu") {
				return "https://meta.icos-cp.eu/sparql";
			} else {
				return "http://127.0.0.1:9094/sparql"
			}
		}

		$(function () {
			$("#result").hide();
			$("#messDiv").hide();

			$("#queryBtn").click(function(){

				$.ajax({
					type: "POST",
					data: {query: $("#query").val()},
					url: getSparqlUrl(),
					dataType: "json",
					success: function(result){
						$("#result").show();
						$("#rowCountSpan").text(result.results.bindings.length + " bindings returned. ");
						$("#messSpan").text("Query executed successfully").show().delay(3000).fadeOut();
						$("#result").html(syntaxHighlight(result));
					},
					error: function(req, textStatus, errorThrown) {
						$("#result").show();
						$("#rowCountSpan").text("");
						$("#messSpan").text("Could not execute query").show().delay(3000).fadeOut();
						console.log(req);
						$("#result").html(req.responseText);
					}
				});
			});
		});

	</script>

	<style type="text/css">
		button{position: relative;top:-11px;}
		.string { color: green; }
		.number { color: darkorange; }
		.boolean { color: blue; }
		.null { color: magenta; }
		.key { color: red; }
	</style>
</head>

<body>

	<div class="container-fluid">

		<div class="row-fluid">
			<div class="span12">
				<textarea id="query" cols="150" rows="10"></textarea>
				<button id="queryBtn" class="btn btn-primary">Submit query</button>
				<span id="rowCountSpan"></span>
				<span id="messSpan"></span>
			</div>
		</div>


		<div class="row-fluid">
			<div class="span12">
				<pre id="result"></pre>
			</div>
		</div>

	</div>

</body>
</html>